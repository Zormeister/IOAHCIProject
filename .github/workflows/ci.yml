name: CI

on:
  - workflow_dispatch
  - push

jobs:
    build:
      runs-on: macos-latest
  
      steps:
        - name: Clone Sources
          uses: actions/checkout@v4
        - name: Build (RELEASE)
          run : |
            xcodebuild install -target IOSerialATAFamily DSTROOT=$PWD/dst
            xcodebuild install -target IOAHCIFamily DSTROOT=$PWD/dst
            xcodebuild install -target PureAHCIDriver DSTROOT=$PWD/dst
        - name: Package (RELEASE)
          run : |
            cd dst
            tar -cvf "IOAHCIProject.tar.xz" .
            cd ../
        - name: Upload Artifact (RELEASE)
          if: success()
          uses: actions/upload-artifact@v4
          with:
            path: /Users/runner/work/IOAHCIProject/dst/IOAHCIProject.tar.xz
        - name: Build (DEBUG)
          run : |
            xcodebuild install -configuration Debug -target IOSerialATAFamily DSTROOT=$PWD/dbgdst
            xcodebuild install -target IOAHCIFamily DSTROOT=$PWD/dbgdst
            xcodebuild install -target PureAHCIDriver DSTROOT=$PWD/dbgdst
        - name: Package (DEBUG)
          run : |
            cd dbgdst
            tar -cvf "IOAHCIProject_debug.tar.xz" .
            cd ../
        - name: Upload Artifact (DEBUG)
          if: success()
          uses: actions/upload-artifact@v4
          with:
            path: /Users/runner/work/IOAHCIProject/dbgdst/IOAHCIProject_debug.tar.xz
    